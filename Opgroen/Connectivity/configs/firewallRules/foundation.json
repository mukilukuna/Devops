{
  "ruleCollectionGroupName": "azure-foundation-collection-group",
  "azureFirewallPolicyResourceName": "*<connWeu-azureFirewallPolicyFoundation_ResourceName>*",
  "priority": 100,
  "ruleCollections": [
    {
      "ruleCollectionType": "FirewallPolicyFilterRuleCollection",
      "name": "Allow-Inbound-Network-Rules",
      "priority": 1000,
      "action": {
        "type": "Allow"
      },
      "rules": [
        {
          "ruleType": "NetworkRule",
          "name": "ICMP",
          "ipProtocols": ["ICMP"],
          "sourceAddresses": ["10.0.0.0/8", "172.16.0.0/12", "192.168.0.0/16"],
          "sourceIpGroups": [],
          "destinationAddresses": ["*<AzureIPSpace>*"],
          "destinationIpGroups": [],
          "destinationFqdns": [],
          "destinationPorts": ["*"]
        }
      ]
    },
    {
      "ruleCollectionType": "FirewallPolicyFilterRuleCollection",
      "name": "Allow-Outbound-Network-Rules",
      "priority": 2000,
      "action": {
        "type": "Allow"
      },
      "rules": [
        {
          "ruleType": "NetworkRule",
          "name": "Azure KMS",
          "ipProtocols": ["TCP"],
          "sourceAddresses": ["*<AzureIPSpace>*"],
          "sourceIpGroups": [],
          "destinationAddresses": [],
          "destinationIpGroups": [],
          "destinationFqdns": [
            "kms.core.windows.net",
            "azkms.core.windows.net"
          ],
          "destinationPorts": ["1688"]
        },
        {
          "ruleType": "NetworkRule",
          "name": "Azure NTP IP",
          "ipProtocols": ["UDP"],
          "sourceAddresses": ["*<AzureIPSpace>*"],
          "sourceIpGroups": [],
          "destinationAddresses": ["40.119.148.38", "20.101.57.9"],
          "destinationIpGroups": [],
          "destinationFqdns": [],
          "destinationPorts": ["123"]
        },
        {
          "ruleType": "NetworkRule",
          "name": "Azure NTP",
          "ipProtocols": ["UDP"],
          "sourceAddresses": ["*<AzureIPSpace>*"],
          "sourceIpGroups": [],
          "destinationAddresses": [],
          "destinationIpGroups": [],
          "destinationFqdns": ["time.windows.com"],
          "destinationPorts": ["123"]
        },
        {
          "ruleType": "NetworkRule",
          "name": "Azure Monitor",
          "ipProtocols": ["TCP"],
          "sourceAddresses": ["*<AzureIPSpace>*"],
          "sourceIpGroups": [],
          "destinationAddresses": [
            "AzureMonitor",
            "ApplicationInsightsAvailability",
            "ActionGroup"
          ],
          "destinationIpGroups": [],
          "destinationFqdns": [],
          "destinationPorts": ["443"]
        },
        {
          "ruleType": "NetworkRule",
          "name": "Azure Advanced Threat Protection",
          "ipProtocols": ["TCP"],
          "sourceAddresses": ["*<AzureIPSpace>*"],
          "sourceIpGroups": [],
          "destinationAddresses": ["AzureAdvancedThreatProtection"],
          "destinationIpGroups": [],
          "destinationFqdns": [],
          "destinationPorts": ["443"]
        },
        {
          "ruleType": "NetworkRule",
          "name": "Azure Backup",
          "ipProtocols": ["TCP"],
          "sourceAddresses": ["*<AzureIPSpace>*"],
          "sourceIpGroups": [],
          "destinationAddresses": ["AzureBackup"],
          "destinationIpGroups": [],
          "destinationFqdns": [],
          "destinationPorts": ["443"]
        },
        {
          "ruleType": "NetworkRule",
          "name": "ICMP",
          "ipProtocols": ["ICMP"],
          "sourceAddresses": ["*<AzureIPSpace>*"],
          "sourceIpGroups": [],
          "destinationAddresses": ["*"],
          "destinationIpGroups": [],
          "destinationFqdns": [],
          "destinationPorts": ["*"]
        }
      ]
    },
    {
      "ruleCollectionType": "FirewallPolicyFilterRuleCollection",
      "name": "Allow-Inbound-Application-Rules",
      "priority": 3000,
      "action": {
        "type": "Allow"
      },
      "rules": []
    },
    {
      "ruleCollectionType": "FirewallPolicyFilterRuleCollection",
      "name": "Allow-Outbound-Application-Rules",
      "priority": 4000,
      "action": {
        "type": "Allow"
      },
      "rules": [
        {
          "ruleType": "ApplicationRule",
          "name": "Azure Defender ATP",
          "protocols": [
            {
              "protocolType": "Https",
              "port": 443
            }
          ],
          "fqdnTags": [],
          "targetFqdns": [
            "winatp-gw-cus.microsoft.com",
            "winatp-gw-cane.microsoft.com",
            "winatp-gw-canc.microsoft.com",
            "winatp-gw-eus.microsoft.com",
            "winatp-gw-cus3.microsoft.com",
            "winatp-gw-eus.microsoft.com",
            "winatp-gw-eus3.microsoft.com",
            "winatp-gw-neu.microsoft.com",
            "winatp-gw-weu.microsoft.com",
            "winatp-gw-neu3.microsoft.com",
            "winatp-gw-weu3.microsoft.com",
            "winatp-gw-uks.microsoft.com",
            "winatp-gw-ukw.microsoft.com",
            "winatp-gw-usmv.microsoft.com",
            "client.wns.windows.com",
            "v10.vortex-win.data.microsoft.com",
            "europe.cp.wd.microsoft.com",
            "checkappexec.microsoft.com",
            "winatp-gw-usmt.microsoft.com",
            "login.live.com",
            "settings-win.data.microsoft.com",
            "*.vortex-win.data.microsoft.com",
            "urs.microsoft.com",
            "go.microsoft.com",
            "fe3cr.delivery.mp.microsoft.com",
            "enterpriseregistration.windows.net",
            "*.dm.microsoft.com",
            "client.wns.windows.com"
          ],
          "targetUrls": [],
          "terminateTLS": false,
          "sourceAddresses": ["*<AzureIPSpace>*"],
          "destinationAddresses": [],
          "sourceIpGroups": []
        },
        {
          "ruleType": "ApplicationRule",
          "name": "Azure Managed Disks",
          "protocols": [
            {
              "protocolType": "Https",
              "port": 443
            }
          ],
          "fqdnTags": [],
          "targetFqdns": ["*.blob.storage.azure.net"],
          "targetUrls": [],
          "terminateTLS": false,
          "sourceAddresses": ["*<AzureIPSpace>*"],
          "destinationAddresses": [],
          "sourceIpGroups": []
        },
        {
          "ruleType": "ApplicationRule",
          "name": "Windows Activation Services",
          "protocols": [
            {
              "protocolType": "Https",
              "port": 443
            }
          ],
          "fqdnTags": [],
          "targetFqdns": ["*.sls.microsoft.com"],
          "targetUrls": [],
          "terminateTLS": false,
          "sourceAddresses": ["*<AzureIPSpace>*"],
          "destinationAddresses": [],
          "sourceIpGroups": []
        },
        {
          "ruleType": "ApplicationRule",
          "name": "Active Protection Services",
          "protocols": [
            {
              "protocolType": "Https",
              "port": 443
            }
          ],
          "fqdnTags": [],
          "targetFqdns": [
            "wdcp.microsoft.com",
            "wdcpalt.microsoft.com",
            "*.smartscreen-prod.microsoft.com"
          ],
          "targetUrls": [],
          "terminateTLS": false,
          "sourceAddresses": ["*<AzureIPSpace>*"],
          "destinationAddresses": [],
          "sourceIpGroups": []
        },
        {
          "ruleType": "ApplicationRule",
          "name": "Windows Update",
          "protocols": [
            {
              "protocolType": "Http",
              "port": 80
            },
            {
              "protocolType": "Https",
              "port": 443
            }
          ],
          "fqdnTags": ["WindowsUpdate"],
          "targetFqdns": [],
          "targetUrls": [],
          "terminateTLS": false,
          "sourceAddresses": ["*<AzureIPSpace>*"],
          "destinationAddresses": [],
          "sourceIpGroups": []
        },
        {
          "ruleType": "ApplicationRule",
          "name": "Windows Update Downloads",
          "protocols": [
            {
              "protocolType": "Http",
              "port": 80
            },
            {
              "protocolType": "Https",
              "port": 443
            }
          ],
          "fqdnTags": [],
          "targetFqdns": [
            "download.windowsupdate.com",
            "adl.windows.com",
            "sls.update.microsoft.com",
            "geover.prod.do.dsp.mp.microsoft.com",
            "ctldl.windowsupdate.com"
          ],
          "targetUrls": [],
          "terminateTLS": false,
          "sourceAddresses": ["*<AzureIPSpace>*"],
          "destinationAddresses": [],
          "sourceIpGroups": []
        },
        {
          "ruleType": "ApplicationRule",
          "name": "Common CRL",
          "protocols": [
            {
              "protocolType": "Http",
              "port": 80
            }
          ],
          "fqdnTags": [],
          "targetFqdns": ["crl.microsoft.com", "*.digicert.com"],
          "targetUrls": [],
          "terminateTLS": false,
          "sourceAddresses": ["*<AzureIPSpace>*"],
          "destinationAddresses": [],
          "sourceIpGroups": []
        },
        {
          "ruleType": "ApplicationRule",
          "name": "Azure GuestConfiguration",
          "protocols": [
            {
              "protocolType": "Https",
              "port": 443
            }
          ],
          "fqdnTags": [],
          "targetFqdns": [
            "*.guestconfiguration.azure.com",
            "oaasguestconfigac2s1.blob.core.windows.net",
            "oaasguestconfigacs1.blob.core.windows.net",
            "oaasguestconfigaes1.blob.core.windows.net",
            "oaasguestconfigases1.blob.core.windows.net",
            "oaasguestconfigbrses1.blob.core.windows.net",
            "oaasguestconfigbrss1.blob.core.windows.net",
            "oaasguestconfigccs1.blob.core.windows.net",
            "oaasguestconfigces1.blob.core.windows.net",
            "oaasguestconfigcids1.blob.core.windows.net",
            "oaasguestconfigcuss1.blob.core.windows.net",
            "oaasguestconfigeaps1.blob.core.windows.net",
            "oaasguestconfigeas1.blob.core.windows.net",
            "oaasguestconfigeus2s1.blob.core.windows.net",
            "oaasguestconfigeuss1.blob.core.windows.net",
            "oaasguestconfigfcs1.blob.core.windows.net",
            "oaasguestconfigfss1.blob.core.windows.net",
            "oaasguestconfiggewcs1.blob.core.windows.net",
            "oaasguestconfiggns1.blob.core.windows.net",
            "oaasguestconfiggwcs1.blob.core.windows.net",
            "oaasguestconfigjiws1.blob.core.windows.net",
            "oaasguestconfigjpes1.blob.core.windows.net",
            "oaasguestconfigjpws1.blob.core.windows.net",
            "oaasguestconfigkcs1.blob.core.windows.net",
            "oaasguestconfigkss1.blob.core.windows.net",
            "oaasguestconfigncuss1.blob.core.windows.net",
            "oaasguestconfignes1.blob.core.windows.net",
            "oaasguestconfignres1.blob.core.windows.net",
            "oaasguestconfignrws1.blob.core.windows.net",
            "oaasguestconfigqacs1.blob.core.windows.net",
            "oaasguestconfigsans1.blob.core.windows.net",
            "oaasguestconfigscuss1.blob.core.windows.net",
            "oaasguestconfigseas1.blob.core.windows.net",
            "oaasguestconfigsecs1.blob.core.windows.net",
            "oaasguestconfigsfns1.blob.core.windows.net",
            "oaasguestconfigsfws1.blob.core.windows.net",
            "oaasguestconfigsids1.blob.core.windows.net",
            "oaasguestconfigstzns1.blob.core.windows.net",
            "oaasguestconfigswcs1.blob.core.windows.net",
            "oaasguestconfigswns1.blob.core.windows.net",
            "oaasguestconfigswss1.blob.core.windows.net",
            "oaasguestconfigswws1.blob.core.windows.net",
            "oaasguestconfiguaecs1.blob.core.windows.net",
            "oaasguestconfiguaens1.blob.core.windows.net",
            "oaasguestconfigukss1.blob.core.windows.net",
            "oaasguestconfigukws1.blob.core.windows.net",
            "oaasguestconfigwcuss1.blob.core.windows.net",
            "oaasguestconfigwes1.blob.core.windows.net",
            "oaasguestconfigwids1.blob.core.windows.net",
            "oaasguestconfigwus2s1.blob.core.windows.net",
            "oaasguestconfigwus3s1.blob.core.windows.net",
            "oaasguestconfigwuss1.blob.core.windows.net"
          ],
          "targetUrls": [],
          "terminateTLS": false,
          "sourceAddresses": ["*<AzureIPSpace>*"],
          "destinationAddresses": [],
          "sourceIpGroups": []
        },
        {
          "ruleType": "ApplicationRule",
          "name": "Azure Update Managment",
          "protocols": [
            {
              "protocolType": "Https",
              "port": 443
            }
          ],
          "fqdnTags": [],
          "targetFqdns": [
            "*.blob.core.windows.net",
            "*.oms.opinsights.azure.com",
            "*.ods.opinsights.azure.com",
            "*.azure-automation.net"
          ],
          "targetUrls": [],
          "terminateTLS": false,
          "sourceAddresses": ["*<AzureIPSpace>*"],
          "destinationAddresses": [],
          "sourceIpGroups": []
        },
        {
          "ruleType": "ApplicationRule",
          "name": "Azure Monitor",
          "protocols": [
            {
              "protocolType": "Https",
              "port": 443
            },
            {
              "protocolType": "Http",
              "port": 80
            }
          ],
          "fqdnTags": [],
          "targetFqdns": [
            "dc.applicationinsights.azure.com",
            "dc.applicationinsights.microsoft.com",
            "dc.services.visualstudio.com",
            "*.in.applicationinsights.azure.com",
            "live.applicationinsights.azure.com",
            "rt.applicationinsights.microsoft.com",
            "rt.services.visualstudio.com",
            "*.livediagnostics.monitor.azure.com",
            "management.core.windows.net",
            "*.blob.core.windows.net",
            "*.oms.opinsights.azure.com",
            "*.ods.opinsights.azure.com",
            "*.azure-automation.net",
            "management.azure.com",
            "login.microsoftonline.com",
            "secure.aadcdn.microsoftonline-p.com",
            "auth.gfx.ms",
            "login.live.com",
            "globalcdn.nuget.org",
            "packages.nuget.org",
            "api.nuget.org",
            "nuget.org",
            "dc.services.vsallin.net",
            "az416426.vo.msecnd.net",
            "js.monitor.azure.com",
            "insightsportal-prod2-cdn.aisvc.visualstudio.com",
            "insightsportal-prod2-asiae-cdn.aisvc.visualstudio.com",
            "insightsportal-cdn-aimon.applicationinsights.io",
            "stamp2.app.insightsportal.visualstudio.com",
            "portal.loganalytics.io",
            "applicationanalytics.azureedge.net",
            "applicationanalyticsmedia.azureedge.net",
            "applicationanalytics.azureedge.net",
            "analytics.applicationinsights.io",
            "aigs1.aisvc.visualstudio.com",
            "api.applicationinsights.io",
            "api1.applicationinsights.io",
            "api2.applicationinsights.io",
            "api3.applicationinsights.io",
            "api4.applicationinsights.io",
            "api5.applicationinsights.io",
            "dev.applicationinsights.io",
            "dev.applicationinsights.microsoft.com",
            "dev.aisvc.visualstudio.com",
            "www.applicationinsights.io",
            "www.applicationinsights.microsoft.com",
            "www.aisvc.visualstudio.com",
            "api.loganalytics.io",
            "*.api.loganalytics.io",
            "dev.loganalytics.io",
            "docs.loganalytics.io",
            "www.loganalytics.io",
            "agent.azureserviceprofiler.net",
            "*.agent.azureserviceprofiler.net",
            "gateway.azureserviceprofiler.net",
            "*.core.windows.net",
            "agent.azureserviceprofiler.net",
            "*.agent.azureserviceprofiler.net",
            "gateway.azureserviceprofiler.net",
            "*.core.windows.net"
          ],
          "targetUrls": [],
          "terminateTLS": false,
          "sourceAddresses": ["*<AzureIPSpace>*"],
          "destinationAddresses": [],
          "sourceIpGroups": []
        }
      ]
    }
  ]
}
