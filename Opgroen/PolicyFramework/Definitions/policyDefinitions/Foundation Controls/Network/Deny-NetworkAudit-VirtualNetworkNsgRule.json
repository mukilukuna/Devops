{
    "name": "Deny-NetworkAudit-VirtualNetworkNsgRule",
    "properties": {
      "Description": "Audit network security groups to have a default DENY Virtualnetwork-VirtualNetwork security rule.",
      "DisplayName": "Network: Audit network security groups to have a default DENY Virtualnetwork-VirtualNetwork security rule.",
      "Mode": "All",
      "metadata": {
        "version": "1.0.0",
        "category": "Network"
      },
      "Parameters": {
        "effect": {
          "type": "String",
          "metadata": {
            "displayName": "Effect",
            "description": "Enable or disable the execution of the policy"
          },
          "allowedValues": [
            "Disabled",
            "AuditIfNotExists"
          ],
          "defaultValue": "AuditIfNotExists"
        },
        "priority": {
          "type": "Integer",
          "metadata": {
            "displayName": "priority",
            "description": "Priority for the deny VirtualNetwork-VirtualNetwork security rule (Example 100)."
          },
          "defaultValue": 4096
        }
      },
      "PolicyRule": {
        "if": {
          "field": "type",
          "equals": "Microsoft.Network/networkSecurityGroups"
        },
        "then": {
          "effect": "[parameters('effect')]",
          "details": {
            "type": "Microsoft.Network/networkSecurityGroups/securityRules",
            "roleDefinitionIds": [
              "/providers/Microsoft.Authorization/roleDefinitions/4d97b98b-1d4f-4787-a291-c67834d212e7"
            ],
            "existenceCondition": {
              "allof": [
                {
                  "field": "Microsoft.Network/networkSecurityGroups/securityRules/access",
                  "equals": "Deny"
                },
                {
                  "field": "Microsoft.Network/networkSecurityGroups/securityRules/direction",
                  "equals": "Inbound"
                },
                {
                  "field": "Microsoft.Network/networkSecurityGroups/securityRules/sourceAddressPrefix",
                  "equals": "*"
                },
                {
                  "field": "Microsoft.Network/networkSecurityGroups/securityRules/destinationAddressPrefix",
                  "equals": "*"
                },
                {
                  "field": "Microsoft.Network/networkSecurityGroups/securityRules/priority",
                  "equals": "[parameters('priority')]"
                }
              ]
            }
          }
        }
      }
    }
  }
  