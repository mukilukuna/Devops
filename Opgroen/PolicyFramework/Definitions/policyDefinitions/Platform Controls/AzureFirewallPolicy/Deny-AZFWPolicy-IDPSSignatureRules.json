{
  "name": "Deny-AZFWPolicy-IDPSSignatureRules",
  "properties": {
    "policyType": "Custom",
    "mode": "Indexed",
    "displayName": "Firewall Policy Premium should enable all IDPS signature rules to monitor all inbound and outbound traffic flows",
    "description": "Enabling all Intrusion Detection and Prevention System (IDPS) signature rules is recommanded to better identify known threats in the traffic flows. To learn more about the Intrusion Detection and Prevention System (IDPS) signatures with Azure Firewall Premium, visit https://aka.ms/fw-idps-signature",
    "metadata": {
      "version": "1.0.0",
      "category": "Network"
    },
    "parameters": {
      "effect": {
        "type": "String",
        "allowedValues": [
          "Audit",
          "Deny",
          "Disabled"
        ],
        "defaultValue": "Audit",
        "metadata": {
          "displayName": "Effect",
          "description": "Enable or disable the execution of the policy"
        }
      }
    },
    "policyRule": {
      "if": {
        "allOf": [
          {
            "field": "type",
            "equals": "Microsoft.Network/firewallPolicies"
          },
          {
            "field": "Microsoft.Network/firewallPolicies/sku.tier",
            "equals": "Premium"
          },
          {
            "count": {
              "field": "Microsoft.Network/firewallPolicies/intrusionDetection.configuration.signatureOverrides[*]",
              "where": {
                "field": "Microsoft.Network/firewallPolicies/intrusionDetection.configuration.signatureOverrides[*].mode",
                "equals": "Off"
              }
            },
            "greaterOrEquals": 1
          }
        ]
      },
      "then": {
        "effect": "[parameters('effect')]"
      }
    }
  }
}
