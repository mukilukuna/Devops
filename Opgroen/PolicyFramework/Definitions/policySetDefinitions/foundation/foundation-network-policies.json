{
  "name": "foundationnwcpolicies",
  "properties": {
    "Description": "This initiative deploys Foundation Network Control Policies for cloud governance",
    "DisplayName": "Foundation Network Control Policy Set Definitions",
    "Mode": null,
    "Metadata": {
      "version": "1.0.0",
      "category": "Governance"
    },
    "PolicyDefinitionGroups":[
      {
        "name": "F.07 - Foundation",
        "category": "Foundation",
        "displayName": "F.07 - Deny Traffic by Default",
        "description": "Deny Traffic by Default"
      },
      {
        "name": "F.23 - Foundation",
        "category": "Foundation",
        "displayName": "F.23 - Enforce Hub-Spoke Topology",
        "description": "Enforce Hub-Spoke Topogoly architecture"
      }
    ],
    "parameters": {
      "effect": {
        "type": "String",
        "metadata": {
          "displayName": "Effect",
          "description": "Enable or disable the execution of the policy"
        },
        "allowedValues": [
          "Audit",
          "Deny",
          "Disabled"
        ],
        "defaultValue": "Deny"
      },
      "networkpreventsubnetsworoutetable_exemptedSubnets": { 
        "type": "Array",
        "metadata": {
          "description": "Subnet exempted from the policy",
          "displayName": "exemptedSubnets"
        },
        "defaultValue": [
          "AzureFirewallManagementSubnet",
          "AzureBastionSubnet",
          "AzureFirewallSubnet"
        ]
      },
      "networkdisablebgproutepropagration_exemptSubscriptions": {
        "type": "Array",
        "metadata": {
          "description": "Subscriptions exempted from the policy",
          "displayName": "exemptedSubscriptions"
        },
        "defaultValue": [
          "*<hubsubscriptionId>*"
        ]
      },
      "networkenforcedefaultroutefirewall_nextHopIpAddress": {
        "type": "Object",
        "defaultValue": {
          "westeurope": {
            "virtualApplianceIpAddress": "*<connWeu-azureFirewall_PrivateIp>*"
          },
          "disabled": {
            "virtualApplianceIpAddress": ""
          }
        },
        "metadata": {
          "displayName": "Next hop IP address",
          "description": "Object containing next hop IP address"
        }
      },
      "Deny-VNet-DnsServers_DnsServers": {
        "type": "Array",
        "defaultValue": [
          "*<connWeu-azureFirewall_PrivateIp>*"
        ],
        "metadata": {
          "description": "The list of DNS servers to enforce exclusive existance of.",
          "displayName": "DNS Servers list"
        }
      },
      "Deny-VNet-DnsServers_exemptSubscriptions": {
        "type": "Array",
        "metadata": {
          "description": "Subscriptions exempted from the policy",
          "displayName": "exemptedSubscriptions"
        },
        "defaultValue": [
          "*<hubsubscriptionId>*"
        ]
      }
    },
    "PolicyDefinitions": [
      {
        "policyDefinitionReferenceId": "Deny-NetworkNextHop-Internet",
        "parameters": {
          "effect": {
            "value": "[parameters('effect')]"
          }
        },
        "groupNames": [
          "F.23 - Foundation"
        ],
        "policyDefinitionName": "Deny-NextHop-Internet"
      },
      {
        "policyDefinitionReferenceId": "Deny-SubnetTwo-RouteTables",
        "parameters": {
            "effect": {
              "value": "[parameters('effect')]"
            },
            "exemptedSubnets": {
              "value": "[parameters('networkpreventsubnetsworoutetable_exemptedSubnets')]"
            }
        },
        "groupNames": [
          "F.23 - Foundation"
        ],
        "policyDefinitionName": "Deny-SubnetTwo-RouteTable"
      },
      {
        "policyDefinitionReferenceId": "Deny-BGPRoutePropagration",
        "parameters": {
          "effect": {
            "value": "[parameters('effect')]"
          },
          "exemptSubscriptions": {
            "value": "[parameters('networkdisablebgproutepropagration_exemptSubscriptions')]"
          }
        },
        "groupNames": [
          "F.07 - Foundation"
        ],
        "policyDefinitionName": "Deny-NetworkBGP-RoutePropagration"
      },
      {
        "policyDefinitionReferenceId": "Enforce-DefaultRoute-ToFirewall",
        "parameters": {
          "effect": {
            "value": "[parameters('effect')]"
          },
          "nextHopIpAddress": {
            "value": "[parameters('networkenforcedefaultroutefirewall_nextHopIpAddress')]"
          }
        },
        "groupNames": [
          "F.23 - Foundation"
        ],
        "policyDefinitionName": "Enforce-Firewall-Defaultroute"
      },
      {
        "policyDefinitionReferenceId": "Deny-VNet-DnsServers",
        "parameters": {
          "effect": {
            "value": "[parameters('effect')]"
          },
          "dnsServers": {
          "value": "[parameters('Deny-VNet-DnsServers_DnsServers')]" 
          },
          "exemptSubscriptions": {
            "value": "[parameters('Deny-VNet-DnsServers_exemptSubscriptions')]" 
            }
        },
        "groupNames": [
          "F.23 - Foundation"
        ],
        "policyDefinitionName": "Deny-VNet-DnsServers"
      }
    ]
  }
}