{
  "name": "platformconpolicies",
  "properties": {
    "Description": "This initiative deploys Platform Connectivity policies for cloud governance and automation.",
    "DisplayName": "Platform Connectivity Policy Set Definitions",
    "Mode": null,
    "Metadata": {
      "version": "1.0.0",
      "category": "Governance"
    },
    "PolicyDefinitionGroups": [
      {
        "name": "PC.01 - Platform",
        "category": "Platform",
        "displayName": "PC.01 - Network Protection",
        "description": "Protection for Networks"
      },
      {
        "name": "PC.02 - Platform",
        "category": "Platform",
        "displayName": "PC.02 - Intrusion detection",
        "description": "Intrusion detection"
      },
      {
        "name": "PC.03 - Platform",
        "category": "Platform",
        "displayName": "PC.03 - Network HA",
        "description": "Network HA"
      },
      {
        "name": "PC.04 - Platform",
        "category": "Platform",
        "displayName": "PC.04 - DDOS Protection",
        "description": "DDOS Protection"
      },
      {
        "name": "PC.05 - Platform",
        "category": "Platform",
        "displayName": "PC.05 - Deny Private DNS Zones",
        "description": "Deny Private DNS Zones"
      },
      {
        "name": "PC.06 - Platform",
        "category": "Platform",
        "displayName": "PC06 - Privileged Access Restrictions",
        "description": "Privileged Access Restrictions"
      }
    ],
    "parameters": {
      "effect": {
        "type": "String",
        "metadata": {
          "displayName": "Effect",
          "description": "Enable or disable the execution of the policy"
        },
        "allowedValues": [
          "Audit",
          "Deny",
          "Disabled"
        ],
        "defaultValue": "Deny"
      },
      "AuditDdosStandard_effect": {
        "type": "String",
        "metadata": {
          "displayName": "Effect",
          "description": "Enable or disable the execution of the policy"
        },
        "allowedValues": [
          "AuditIfNotExists",
          "Disabled"
        ],
        "defaultValue": "Disabled"
      },
      "DenyAZFWPolicyDnsServers_dnsServers": {
        "type": "Array",
        "defaultValue": [
          "168.63.129.16",
          "*<idenWeu-virtualMachineAddc01_PrivateIp>*",
          "*<idenWeu-virtualMachineAddc02_PrivateIp>*"
        ],
        "metadata": {
          "description": "The list of DNS servers to enforce exclusive existance of.",
          "displayName": "DNS Servers list"
        }
      },
      "DenyAZFW_sku": {
        "type": "String",
        "defaultValue": "Standard",
        "metadata": {
          "description": "The sku of the Azure Firewall.",
          "displayName": "Azure Firewall SKU"
        }
      }
    },
    "PolicyDefinitions": [
      {
        "policyDefinitionReferenceId": "Deny-ErGateway-Sku",
        "parameters": {
          "effect": {
            "value": "[parameters('effect')]"
          }
        },
        "groupNames": [
          "PC.03 - Platform"
        ],
        "policyDefinitionName": "Deny-ERGateway-sku"
      },
      {
        "policyDefinitionReferenceId": "Deny-VPNGateway-Sku",
        "parameters": {
          "effect": {
            "value": "[parameters('effect')]"
          }
        },
        "groupNames": [
          "PC.03 - Platform"
        ],
        "policyDefinitionName": "Deny-VPNGateway-sku"
      },
      {
        "policyDefinitionReferenceId": "Deny-AZFW-Sku",
        "parameters": {
          "effect": {
            "value": "[parameters('effect')]"
          },
          "sku": {
            "value": "[parameters('DenyAZFW_sku')]"
          }
        },
        "groupNames": [
          "PC.03 - Platform"
        ],
        "policyDefinitionName": "Deny-AZFW-sku"
      },
      {
        "policyDefinitionReferenceId": "Deny-AZFWPolicy-IDPSBypass",
        "parameters": {
          "effect": {
            "value": "[parameters('effect')]"
          }
        },
        "groupNames": [
          "PC.02 - Platform"
        ],
        "policyDefinitionName": "Deny-AZFWPolicy-IDPSBypass"
      },
      {
        "policyDefinitionReferenceId": "Deny-AZFWPolicy-IDPSignatureRules",
        "parameters": {
          "effect": {
            "value": "[parameters('effect')]"
          }
        },
        "groupNames": [
          "PC.02 - Platform"
        ],
        "policyDefinitionName": "Deny-AZFWPolicy-IDPSSignatureRules"
      },
      {
        "policyDefinitionReferenceId": "Deny-AZFWPolicy-ThreatIntelMode",
        "parameters": {
          "effect": {
            "value": "[parameters('effect')]"
          }
        },
        "groupNames": [
          "PC.02 - Platform"
        ],
        "policyDefinitionName": "Deny-AZFWPolicy-ThreatIntelMode"
      },
      {
        "policyDefinitionReferenceId": "Deny-AZFWPolicy-IDPSOff",
        "parameters": {
          "effect": {
            "value": "[parameters('effect')]"
          }
        },
        "groupNames": [
          "PC.01 - Platform"
        ],
        "policyDefinitionName": "Deny-AZFWPolicy-IDPSOff"
      },
      {
        "policyDefinitionReferenceId": "Deny-GatewaySubnet-NSG",
        "parameters": {},
        "groupNames": [
          "PC.02 - Platform"
        ],
        "policyDefinitionName": "35f9c03a-cc27-418e-9c0c-539ff999d010"
      },
      {
        "policyDefinitionReferenceId": "DenyAZFWPolicyDnsServers",
        "parameters": {
          "effect": {
            "value": "[parameters('effect')]"
          },
          "dnsServers": {
            "value": "[parameters('DenyAZFWPolicyDnsServers_dnsServers')]"
          }
        },
        "groupNames": [
          "PC.01 - Platform"
        ],
        "policyDefinitionName": "Deny-AZFWPolicy-DnsServers"
      },
      {
        "policyDefinitionReferenceId": "Audit-Ddos-Standard",
        "parameters": {
          "effect": {
            "value": "[parameters('AuditDdosStandard_effect')]"
          }
        },
        "groupNames": [
          "PC.04 - Platform"
        ],
        "policyDefinitionName": "a7aca53f-2ed4-4466-a25e-0b45ade68efd"
      },
      {
        "policyDefinitionReferenceId": "Deny creation of Private Link DNS Zones",
        "parameters": {
          "effect": {
            "value": "Deny"
          },
          "exemptSubscriptions": {
            "value": [
              "*<identitySubscriptionId>*"
            ]
          }
        },
        "groupNames": [
          "PC.05 - Platform"
        ],
        "policyDefinitionName": "Deny-DNSPrivatelink-ZoneCreation"
      },
      {
        "policyDefinitionReferenceId": "Audit-Identity-AllowedRoledefinitionId",
        "parameters": {
          "effect": {
            "value": "Audit"
          },
          "roleDefinitionIds": {
            "value": [
              "8e3af657-a8ff-443c-a75c-2fe8c4bcb635",
              "b24988ac-6180-42a0-ab88-20f7382dd24c",
              "acdd72a7-3385-48ef-bd42-f606fba81ae7",
              "18d7d88d-d35e-4fb5-a5c3-7773c20a72d9",
              "fb1c8493-542b-48eb-b624-b4c8fea62acd",
              "39bc4728-0917-49c7-9d2c-d95423bc2eb4",
              "350f8d15-c687-4448-8ae1-157740a3936d",
              "92aaf0da-9dab-42b6-94a3-d43ce8d16293",
              "5d58bcaf-24a5-4b20-bdb6-eed9f69fbe4c",
              "749f88d5-cbae-40b8-bcfc-e573ddc772fa",
              "4d97b98b-1d4f-4787-a291-c67834d212e7",
              "36243c78-bf99-498c-9df9-86d9f8d28608",
              "de139f84-1756-47ae-9be6-808fbbe84772",
              "49335691-517f-518d-b431-8bdfb0210688",
              "9980e02c-c2be-4d73-94e8-173b1dc7cf3c",
              "cd570a14-e51a-42ad-bac8-bafd67325302",
              "2a2b9908-6ea1-4ae2-8e65-a410df84e7d1",
              "17d1049b-9a84-46fb-8f53-869881c3d3ab",
              "17d1049b-9a84-46fb-8f53-869881c3d3ab",
              "f58310d9-a9f6-439a-9e8d-f62e7b41a168",
              "*<managementGroup-virtualNetworkPeeringContributor_RoleDefinitionId>*",
              "*<managementGroup-policyReaderRole_RoleDefinitionId>*",
              "*<managementGroup-onlineConnectedContributor_RoleDefinitionId>*",
              "*<managementGroup-corporateContributor_RoleDefintionId>*",
              "*<managementGroup-azureRolesReaderRole_RoleDefinitionId>*",
              "*<managementGroup-azureLockAdministrator_RoleDefinitionId>*",
              "*<managementGroup-azureFirewallRuleCollectionGroupContributor_RoleDefinitionId>*",
              "*<managementGroup-accessManagementAdministrator_RoleDefinitionId>*",
              "d5a2ae44-610b-4500-93be-660a0c5f5ca6"
            ]
          }
        },
        "groupNames": [
          "PC.06 - Platform"
        ],
        "policyDefinitionName": "Audit-Identity-AllowedRoledefinitionId"
      },
      {
        "policyDefinitionReferenceId": "Audit-Identity-AllowedPrincipalIds",
        "parameters": {
          "effect": {
            "value": "Audit"
          },
          "principalIds": {
            "value": [
              "314bc2d1-f88b-4090-82be-9fe3ab3b8945",
              "5725665b-dd48-4b5c-92f9-8bf712cd5fc9",
              "72cfa955-b4ad-4d8c-9991-add977528de8",
              "4ae741c4-4a8e-4e09-85ad-88d2f0684126",
              "e8254b4b-cb43-4840-86d7-c79fa9c7dfca",
              "dc184c1c-a7b0-46f9-9153-fa086fc7f44e",
              "54797cb8-69ba-4790-bac3-3056234fb7cd",
              "01b95e67-d30b-4e08-a1d3-97a04951cc82",
              "7ab3cab1-73ff-4fc8-b136-72187442d30e",
              "88c0a8ea-1a13-4d5d-a6b7-1c1bd2bee14c",
              "1f0f016f-93fc-4d10-b205-fbb73b3716c7",
              "9a4e861b-e094-4de7-b139-d399fc65cd63",
              "139af9b9-faca-48df-8f77-7932a9ad1e9f",
              "57d13376-331c-40af-beb2-05084049bbca",
              "b62dd229-6df1-4606-a963-be1b46790b04",
              "c80cd406-0a66-4159-b415-34d3b1afc245",
              "6f9b28b5-4a74-4793-9f71-676a3c1d68f7",
              "4f2a9d38-6907-421c-8f0b-7352021f92ae",
              "43ba4f13-2971-4cc0-b448-7fb140102131",
              "1196646a-3013-44c0-a498-cda7af93ddce",
              "6b9505db-3f1e-49e0-977f-a1e26d24740e",
              "5d571aa7-06df-4ac5-b908-bcc58869343c",
              "7010d1ff-10a4-488f-861b-14e710127b51",
              "2f3db1d6-fa33-4199-9b7c-bd0f77e9a8bb",
              "8254c0a4-bd6d-43e4-ad70-15ed2d83bc4f",
              "c216751b-eab2-4fe3-bdc7-e6f86fdc34ef",
              "73f3b3d4-87f2-4f6c-ac40-4d5f01c7da20",
              "165f5f4f-8877-45c5-a5b9-103df0174a69",
              "0b252339-a15d-4acc-96a6-75727a3793e6",
              "53832d5c-a342-4218-a118-e193bee61893",
              "ec0b238f-e354-4bd2-8378-47e1fe75ce2a"
            ]
          }
        },
        "groupNames": [
          "PC.06 - Platform"
        ],
        "policyDefinitionName": "Audit-Identity-AllowedPrincipalIds"
      }
    ]
  }
}