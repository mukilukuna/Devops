parameters:
  - name: AZURE_DEVOPS_EXT_PAT
    type: string
  - name: organization
    type: string
  - name: project
    type: string
  - name: varKey
    type: string
    default: ''
  - name: varValue
    type: string
    default: ''
  - name: varMultiple
    type: string
    default: ''
  - name: preFix
    type: string
    default: ''
  - name: isSecret
    type: string
  - name: environment
    type: string
  - name: templateRepo
    type: string

steps:
  - task: PowerShell@2
    displayName: Install az devops extension
    inputs:
      targetType: "inline"
      script: |
        az config set extension.use_dynamic_install=yes_without_prompt
        az extension add --name azure-devops

  - task: PowerShell@2
    displayName: add ${{ parameters.varKey }} to var group
    inputs:
      filePath: "$(System.DefaultWorkingDirectory)/${{ parameters.templateRepo }}/.Global/Scripts/Add-VariableGroupStandAlone.ps1"
    env:
      AZURE_DEVOPS_EXT_PAT: ${{ parameters.AZURE_DEVOPS_EXT_PAT }}
      organization: ${{ parameters.organization }}
      project: ${{ parameters.project }}
      templateRepo: ${{ parameters.templateRepo }}
      varKey: ${{ parameters.varKey }}
      varValue: ${{ parameters.varValue }}
      varMultiple: ${{ parameters.varMultiple }}
      preFix: ${{ parameters.preFix }}
      isSecret: ${{ parameters.isSecret }}
      environment: ${{ parameters.environment }}
